# Contexto da Feature: Chat NEX

## Visao Geral

Assistente de chat com dois modos operacionais:
- **Modo livre** (sem documento): responde duvidas gerais sobre SST, NRs, EPIs, compliance e seguranca do trabalho.
- **Modo grounded** (com documento): restrito ao conteudo do documento carregado, atua como auditor forense.

A transicao entre modos e automatica: ao carregar um documento, o chat reinicia e muda para grounded.

## Decisoes Arquiteturais

- **Dois system prompts**: a API `/api/chat-documento` seleciona o prompt baseado na presenca de `documentContext`.
- **Botao FAB flutuante**: chat acessivel a qualquer momento via botao fixo no canto inferior direito (`AnaliseCliente.tsx`).
- **UX moderna**: layout inspirado em ChatGPT/Claude -- mensagens do assistente sem avatar, bolhas do usuario em indigo, input com borda pill e botao ArrowUp.
- **Renderizacao Markdown**: respostas renderizadas via `react-markdown` + `remark-gfm`.
- **Acessibilidade**: `aria-labels`, `role="log"`, `aria-live="polite"`, `useReducedMotion()` e contraste WCAG.
- **Determinismo de IA**: providers configurados com `temperature=0`, `top_p=1`, `seed=42`.

## Componentes

| Componente | Responsabilidade |
|---|---|
| `ChatSidePanel.tsx` | Painel lateral com header (logo gradiente, status inline), footer semantico (Shield/Zap) |
| `ChatInterface.tsx` | Core: mensagens, input pill, scroll, sugestoes adaptativas, typing indicator |
| `ChatMessageBubble.tsx` | Mensagem do usuario (bolha indigo) e do assistente (texto direto, sem bolha) com Markdown, copiar e retry |
| `ChatTypingIndicator.tsx` | Dots animados + texto "NEX pensando..." |
| `ChatSuggestions.tsx` | Grid 2x2 com perguntas sugeridas adaptadas ao modo (livre/grounded) |

## Fluxo

1. Chat acessivel via FAB flutuante (sem necessidade de documento).
2. Sem documento: modo livre com sugestoes de SST geral.
3. Com documento carregado: transicao automatica para modo grounded com reset de mensagens.
4. Mensagem enviada para `POST /api/chat-documento` com ou sem `documentContext`.
5. Resposta renderizada em Markdown com toolbar de copiar on-hover.
6. Erros com estilo distinto (borda vermelha) e botao "Tentar novamente".

## Dependencias

- `react-markdown` + `remark-gfm`
- `framer-motion` (`useReducedMotion`)
- `lucide-react` (ArrowUp, ArrowDown, Copy, Check, X, Shield, Zap, etc.)
- shadcn/ui tokens (`cn`, cores SGN)
